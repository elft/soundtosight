class SmokeAndMirrorsVisualizer extends BaseVisualizer{constructor(t,s){super(t,{backgroundColor:"#04040a",force2d:!0,stereo:!0,smoothing:.78,...s})}async init(){this.time=0,this.lastFrameTime=performance.now(),this.smoothedLeft=0,this.smoothedRight=0,this.leftFlow=0,this.rightFlow=0,this.smoothedSubBass=0,this.smoothedBass=0,this.smoothedLowMid=0,this.smoothedMid=0,this.smoothedUpperMid=0,this.smoothedPresence=0,this.smoothedTreble=0,this.smoothedBrilliance=0,this.stereoDrift=0,this.beatPulse=0,this.projectorPulse=0,this.projectorGlow=0,this.beamShimmer=0,this.apparitionLift=0,this.spectralFlare=0,this.mirrorSweep=0,this.projectorFlicker=0,this.overlayGlow=this.createOverlay("smokeMirrorsGlow"),this.overlaySpecter=this.createOverlay("smokeMirrorsSpecter"),this.ripples=[],this.smokeWisps=[],this.mirrorShards=[],this.mirrorPanels=[],this.apparitionLayers=[],this.beamParticles=[],this.lensEmbers=[],this.reseedFields()}onResize(){this.reseedFields()}onUpdate(t){if(!t)return;const s=this.safeNumber(t.rmsLeft,t.rms||0),e=this.safeNumber(t.rmsRight,t.rms||0);this.smoothedLeft=this.lerp(this.smoothedLeft,this.clamp(s,0,1),.2),this.smoothedRight=this.lerp(this.smoothedRight,this.clamp(e,0,1),.2),this.smoothedSubBass=this.lerp(this.smoothedSubBass,this.clamp(t.subBassEnergy||0,0,1.5),.08),this.smoothedBass=this.lerp(this.smoothedBass,this.clamp(t.bassEnergy||0,0,1.5),.1),this.smoothedLowMid=this.lerp(this.smoothedLowMid,this.clamp(t.lowMidEnergy||0,0,1.5),.12),this.smoothedMid=this.lerp(this.smoothedMid,this.clamp(t.midEnergy||0,0,1.5),.12),this.smoothedUpperMid=this.lerp(this.smoothedUpperMid,this.clamp(t.upperMidEnergy||0,0,1.5),.12),this.smoothedPresence=this.lerp(this.smoothedPresence,this.clamp(t.presenceEnergy||0,0,1.5),.14),this.smoothedTreble=this.lerp(this.smoothedTreble,this.clamp(t.trebleEnergy||0,0,1.5),.14),this.smoothedBrilliance=this.lerp(this.smoothedBrilliance,this.clamp(t.brillianceEnergy||0,0,1.5),.16);const i=this.safeNumber(t.stereoBalance,0);this.stereoDrift=this.lerp(this.stereoDrift,i*(.12*this.width),.08);const h=this.extractChannelEnergy(t.frequencyLeft),r=this.extractChannelEnergy(t.frequencyRight);this.leftFlow=this.lerp(this.leftFlow,h,.18),this.rightFlow=this.lerp(this.rightFlow,r,.18);const o=.5*this.smoothedPresence+.4*this.smoothedTreble+.6*this.smoothedBrilliance;this.spectralFlare=this.lerp(this.spectralFlare,this.clamp(o,0,3),.14);const a=.7*this.smoothedSubBass+.6*this.smoothedBass+.4*this.smoothedLowMid;this.projectorPulse=this.lerp(this.projectorPulse,this.clamp(a,0,3),.12),this.projectorGlow=this.lerp(this.projectorGlow,this.clamp(.8*this.smoothedBass+.5*this.smoothedMid,0,2.6),.1),this.beamShimmer=this.lerp(this.beamShimmer,this.clamp(o+.6*(this.leftFlow+this.rightFlow),0,3.4),.12),this.apparitionLift=this.lerp(this.apparitionLift,this.clamp(.5*this.smoothedMid+.7*this.smoothedUpperMid+.5*this.smoothedPresence,0,2.8),.11);const l=this.clamp(.6*(this.smoothedLeft-this.smoothedRight)+.9*(this.leftFlow-this.rightFlow),-3,3);if(this.mirrorSweep=this.lerp(this.mirrorSweep,l,.15),this.projectorFlicker=this.lerp(this.projectorFlicker,.06*(this.smoothedPresence+this.smoothedTreble+this.smoothedBrilliance)+.04*Math.random(),.25),(t.isBeat||t.isBeatSpike)&&(this.beatPulse=1,this.projectorFlicker+=.18),t.bassDrop){const s=this.clamp(t.bassDropIntensity??this.smoothedBass+this.smoothedSubBass,.1,2);this.spawnMirrorRipple(s)}this.time=this.safeNumber(t.time,this.time+.016)}onRender(){const t=performance.now(),s=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t;const e=this.ctx;if(!e)return;const i=this.clamp(.35-.05*this.smoothedSubBass,.16,.35);e.fillStyle=`rgba(4, 4, 12, ${i})`,e.fillRect(0,0,this.width,this.height),this.drawStage(e),this.drawProjectionBeam(e,s),this.drawMirrors(s),this.drawApparition(s),this.drawSmoke(e,s),this.drawProjector(e,s),this.drawRipples(e,s),this.beatPulse*=.9}drawStage(t){const s=this.width/2+.3*this.stereoDrift,e=this.safeGradient(t,0,0,0,this.height);e.addColorStop(0,`rgba(6, 8, 20, ${.65-.1*this.smoothedTreble})`),e.addColorStop(.55,"rgba(8, 12, 24, 0.88)"),e.addColorStop(1,"rgba(2, 4, 10, 0.95)"),t.save(),t.fillStyle=e,t.fillRect(0,0,this.width,this.height);const i=this.safeRadialGradient(t,s,.42*this.height,.05*this.width,s,.42*this.height,.8*this.width);i.addColorStop(0,`rgba(30, 60, 120, ${.08+.08*this.smoothedMid})`),i.addColorStop(1,"rgba(4, 6, 12, 0)"),t.globalCompositeOperation="lighter",t.globalAlpha=.8,t.fillStyle=i,t.fillRect(0,0,this.width,this.height);const h=.18*this.width;t.globalCompositeOperation="screen",t.globalAlpha=.22+.08*this.smoothedLowMid;const r=this.safeGradient(t,0,0,h,this.height);r.addColorStop(0,"rgba(8, 10, 18, 0.8)"),r.addColorStop(1,"rgba(4, 5, 12, 0)"),t.fillStyle=r,t.fillRect(0,0,1.2*h,this.height);const o=this.safeGradient(t,this.width-h,0,this.width,this.height);o.addColorStop(0,"rgba(4, 5, 12, 0)"),o.addColorStop(1,"rgba(8, 10, 18, 0.85)"),t.fillStyle=o,t.fillRect(this.width-1.2*h,0,1.2*h,this.height),t.restore()}drawProjectionBeam(t,s){const e=this.width/2+.25*this.stereoDrift,i=.92*this.height,h=.26*this.height-this.apparitionLift*this.height*.04,r=this.map(this.projectorPulse+.6*this.beatPulse,0,3,.05*this.width,.28*this.width),o=this.mirrorSweep*this.width*.012,a=this.map(this.smoothedPresence+this.smoothedTreble,0,3,.25*r,.6*r),l=this.safeGradient(t,e,h,e,i),d=.22+.08*this.projectorPulse+this.projectorFlicker;l.addColorStop(0,`rgba(110, 160, 255, ${.06+.04*this.spectralFlare})`),l.addColorStop(.45,`rgba(90, 150, 230, ${.4*d})`),l.addColorStop(.9,`rgba(60, 120, 210, ${d})`),l.addColorStop(1,"rgba(12, 20, 40, 0)"),t.save(),t.globalCompositeOperation="lighter",t.beginPath(),t.moveTo(e-r,i),t.lineTo(e+r,i),t.lineTo(e+o+a,h),t.lineTo(e-o-a,h),t.closePath(),t.fillStyle=l,t.fill();const p=this.safeGradient(t,e-.15*r,h,e+.15*r,i);p.addColorStop(0,`rgba(200, 220, 255, ${.2+.1*this.spectralFlare})`),p.addColorStop(1,`rgba(80, 120, 220, ${.08+.06*this.projectorPulse})`),t.globalAlpha=.85,t.fillStyle=p,t.fillRect(e-.3*r,h,.6*r,i-h);const n=60+90*this.projectorPulse+40*this.spectralFlare;for(const a of this.beamParticles){a.y-=s*(a.speed+n),a.y<h+.05*r&&(a.y=i-Math.random()*this.height*.08,a.offset=this.map(Math.random(),0,1,-1,1));const l=a.layer,d=r*(.2+.5*l),p=e+.2*o+a.offset*d,m=a.y;t.globalAlpha=this.clamp(.05+.05*this.spectralFlare+.1*l,.04,.5),t.fillStyle="rgba(200, 220, 255, 1)",t.beginPath(),t.ellipse(p,m,a.size,a.size*(1.6+.6*l),a.seed+.6*this.time,0,2*Math.PI),t.fill()}t.restore()}drawApparition(t){if(!this.overlaySpecter?.ctx)return;const s=this.overlaySpecter.ctx;s.save(),s.globalCompositeOperation="source-over",s.fillStyle="rgba(0, 0, 0, 0.18)",s.fillRect(0,0,this.width,this.height);const e=this.width/2+.18*this.stereoDrift,i=this.height*(.36-.05*this.apparitionLift)+Math.sin(.6*this.time)*this.height*.01;s.translate(e,i),s.globalCompositeOperation="screen";const h=.35+.15*this.spectralFlare;for(const e of this.apparitionLayers){e.phase+=t*(.4+.6*this.spectralFlare+.5*e.drift);const i=.4*Math.sin(e.phase+e.seed),r=this.width*e.radius*(1+.25*this.apparitionLift+.2*i),o=h+.4*e.depth,a=.25*e.phase+.5*e.seed;s.save(),s.rotate(a+.05*this.mirrorSweep);const l=this.safeRadialGradient(s,0,0,.05*r,0,0,r);l.addColorStop(0,`hsla(${200+e.hueShift}, 85%, ${65+10*o}%, ${.24+.1*o})`),l.addColorStop(.6,`hsla(${220+e.hueShift}, 90%, ${55+10*o}%, ${.12+.08*o})`),l.addColorStop(1,`hsla(${240+e.hueShift}, 90%, 45%, 0)`),s.globalAlpha=this.clamp(.12+.12*o+.08*this.beatPulse,0,.8),s.fillStyle=l,s.beginPath();for(let t=0;t<e.points;t++){const i=2*Math.PI*t/e.points,h=Math.sin(i*(2+e.curl)+e.phase)*e.wave,o=Math.cos(i)*r*(1+.12*h),a=Math.sin(i)*r*(e.eccentricity+.18*h);0===t?s.moveTo(o,a):s.lineTo(o,a)}s.closePath(),s.fill(),s.restore()}s.restore()}drawSmoke(t,s){const e=this.width/2+.35*this.stereoDrift,i=.45*this.height-this.apparitionLift*this.height*.02,h=.8*this.smoothedLowMid+.5*this.smoothedMid+.6*this.beatPulse,r=this.smoothedSubBass*this.height*.03,o=120*(this.projectorPulse+this.smoothedBass),a=.4*this.spectralFlare+2*this.projectorFlicker;t.save(),t.globalCompositeOperation="screen";for(const l of this.smokeWisps){l.phase+=s*l.speed*(.6+h);const d=l.side<0?this.smoothedLeft+this.leftFlow:l.side>0?this.smoothedRight+this.rightFlow:.5*(this.smoothedLeft+this.smoothedRight)+.5*(this.leftFlow+this.rightFlow),p=this.clamp(d*(.6+.4*this.beatPulse)+.2*this.spectralFlare,0,2.6),n=i+l.offsetY*this.height*.45+r*(0===l.layer?-1:1),m=Math.sin(l.phase+l.seed)*(l.range+o*l.depth),c=Math.cos(.7*l.phase+1.3*l.seed)*l.range*.6*(1+.4*this.smoothedMid),g=e+(this.stereoDrift*(.45+.6*l.depth)+12*this.mirrorSweep*l.depth)+l.side*this.width*l.spread+m+c,f=this.clamp(l.baseThickness*(.4+.7*p),6,220);t.save(),t.globalAlpha=.05+.14*p+.03*a,t.lineWidth=f,t.lineCap="round",t.lineJoin="round";const M=.12*this.height+140*this.smoothedBass,b=g-.5*M,S=g+.5*M,u=n-.18*f,w=n+.18*f,P=(0===l.layer?200:260)+50*p+45*this.smoothedBrilliance,y=this.safeGradient(t,b,u,S,w);y.addColorStop(0,`hsla(${P-30}, 60%, ${20+20*p}%, 0)`),y.addColorStop(.5,`hsla(${P}, 70%, ${45+18*p}%, 0.55)`),y.addColorStop(1,`hsla(${P+30}, 60%, ${18+18*p}%, 0)`),t.strokeStyle=y,t.beginPath(),t.moveTo(b,u),t.bezierCurveTo(e+Math.sin(.8*l.phase+2.1*l.seed)*M,n-.4*f,e+Math.cos(.6*l.phase+1.7*l.seed)*M,n+.4*f,S,w),t.stroke(),t.restore()}t.restore()}drawProjector(t,s){const e=this.width/2+.2*this.stereoDrift,i=.95*this.height,h=.14*this.width,r=.08*this.height,o=.3+.18*this.projectorGlow+this.projectorFlicker;t.save(),t.translate(e,i);const a=this.safeGradient(t,-h,0,h,-r);a.addColorStop(0,"rgba(12, 18, 32, 0.95)"),a.addColorStop(.5,"rgba(20, 28, 45, 0.95)"),a.addColorStop(1,"rgba(12, 18, 32, 0.95)"),t.fillStyle=a,t.fillRect(-h,-r,2*h,r);const l=this.map(this.projectorPulse,0,3,.02*this.width,.045*this.width),d=this.safeRadialGradient(t,0,.3*-r,.2*l,0,.3*-r,l);d.addColorStop(0,`rgba(220, 240, 255, ${.4+.3*o})`),d.addColorStop(1,`rgba(80, 130, 220, ${.05+.2*o})`),t.beginPath(),t.arc(0,.3*-r,l,0,2*Math.PI),t.fillStyle=d,t.fill();const p=this.safeRadialGradient(t,0,.3*-r,.9*l,0,.3*-r,2.4*l);p.addColorStop(0,`rgba(140, 200, 255, ${.3+.2*o})`),p.addColorStop(1,"rgba(20, 40, 80, 0)"),t.globalCompositeOperation="lighter",t.globalAlpha=.7,t.fillStyle=p,t.beginPath(),t.arc(0,.3*-r,2.2*l,0,2*Math.PI),t.fill(),t.restore(),this.drawProjectorMotes(t,e,i,l,s)}drawProjectorMotes(t,s,e,i,h){t.save(),t.globalCompositeOperation="lighter";for(const r of this.lensEmbers){r.phase+=h*(r.speed+.8*this.projectorPulse);const o=i*(1.2+r.radiusMod),a=s+Math.cos(r.phase+r.seed)*o,l=e-.08*this.height+Math.sin(1.4*r.phase+2*r.seed)*o*.4-r.rise*this.projectorPulse*this.height*.02,d=.1+.1*this.projectorGlow+this.projectorFlicker+r.brightness;t.globalAlpha=this.clamp(d,.04,.6),t.fillStyle="rgba(200, 220, 255, 1)",t.beginPath(),t.arc(a,l,r.size,0,2*Math.PI),t.fill()}t.restore()}drawMirrors(t){if(!this.overlayGlow?.ctx)return;const s=this.overlayGlow.ctx;s.save(),s.globalCompositeOperation="source-over",s.fillStyle="rgba(0, 0, 0, 0.24)",s.fillRect(0,0,this.width,this.height);const e=this.width/2+.55*this.stereoDrift,i=this.clamp(.8*this.smoothedLeft+1.2*this.leftFlow+.08*this.beamShimmer,0,3),h=this.clamp(.8*this.smoothedRight+1.2*this.rightFlow+.08*this.beamShimmer,0,3);this.drawMirrorPanels(s,t,e,-1,i),this.drawMirrorPanels(s,t,e,1,h);for(const r of this.mirrorShards)r.phase+=t*r.spin*(1.2+.8*this.spectralFlare),this.drawMirrorShard(s,r,-1,i,e),this.drawMirrorShard(s,r,1,h,e);s.restore()}drawMirrorPanels(t,s,e,i,h){for(const r of this.mirrorPanels){if(r.side!==i)continue;r.phase+=s*(r.oscillation+.7*this.smoothedUpperMid+.5*this.spectralFlare);const o=(.04*this.mirrorSweep+Math.sin(r.phase)*r.swing)*i,a=e+i*(this.width*r.orbit+.1*this.width),l=this.height*r.heightBase,d=this.height*r.heightScale*(1+.2*h),p=this.width*r.widthScale*(.8+.3*h);t.save(),t.translate(a,l),t.rotate(o);const n=this.safeGradient(t,.6*-p,-d,.6*p,d);n.addColorStop(0,`hsla(${200+r.hueShift}, 60%, 55%, ${.08+.04*h})`),n.addColorStop(.5,`hsla(${210+r.hueShift}, 70%, 65%, ${.18+.1*h})`),n.addColorStop(1,`hsla(${240+r.hueShift}, 80%, 60%, ${.08+.04*h})`),t.beginPath(),t.moveTo(-p,0),t.lineTo(.4*-p,-d),t.lineTo(.4*p,.8*-d),t.lineTo(p,0),t.closePath(),t.globalAlpha=.18+.08*h,t.fillStyle=n,t.fill(),t.globalAlpha=.08+.06*h,t.lineWidth=1.2+1.4*h,t.strokeStyle=`hsla(${220+r.hueShift}, 90%, 75%, 1)`,t.stroke(),t.restore()}}drawMirrorShard(t,s,e,i,h){const r=this.width*(s.orbit+.1)+e*this.mirrorSweep*this.width*.04,o=this.height*s.heightFactor+Math.sin(.6*s.phase+s.seed)*this.height*.06*(1+.3*this.smoothedMid),a=h+e*r,l=this.clamp(s.baseSize*(.4+1.1*i),10,.16*this.width),d=this.clamp(l*(1.4+.9*this.smoothedPresence),24,.36*this.height),p=s.phase*e*(.4+.6*i)+.06*this.mirrorSweep*e;t.save(),t.translate(a,o),t.rotate(p),t.scale(e,1);const n=190+s.colorShift+30*this.spectralFlare,m=.16+.14*i,c=this.safeGradient(t,.5*-l,-d,.5*l,d);c.addColorStop(0,`hsla(${n-40}, 70%, 60%, ${.2*m})`),c.addColorStop(.4,`hsla(${n}, 80%, 65%, ${.9*m})`),c.addColorStop(.7,`hsla(${n+25}, 75%, 70%, ${m})`),c.addColorStop(1,`hsla(${n+60}, 70%, 55%, ${.5*m})`),t.beginPath(),t.moveTo(0,-d),t.lineTo(.55*l,.18*-d),t.lineTo(.25*l,.22*d),t.lineTo(0,d),t.lineTo(.35*-l,.25*d),t.lineTo(.55*-l,.1*-d),t.closePath(),t.fillStyle=c,t.globalAlpha=.35+.18*i,t.fill(),t.globalAlpha=.12+.1*i,t.lineWidth=1.2+1.6*i,t.strokeStyle=`hsla(${n+40}, 90%, 75%, 1)`,t.stroke(),t.restore()}drawRipples(t,s){if(!this.ripples.length)return;const e=this.width/2+.4*this.stereoDrift,i=this.height/2;for(let h=this.ripples.length-1;h>=0;h--){const r=this.ripples[h];if(r.radius+=r.speed*s,r.alpha*=.96,r.alpha<.02||r.radius>r.maxRadius){this.ripples.splice(h,1);continue}const o=this.safeGradient(t,e-r.radius,i-r.radius,e+r.radius,i+r.radius);o.addColorStop(0,`hsla(210, 90%, 70%, ${.4*r.alpha})`),o.addColorStop(.6,`hsla(200, 95%, 75%, ${.24*r.alpha})`),o.addColorStop(1,"rgba(10, 20, 40, 0)"),t.save(),t.globalCompositeOperation="screen",t.lineWidth=r.bandWidth,t.strokeStyle=`rgba(180, 220, 255, ${r.alpha})`,t.beginPath(),t.arc(e,i,r.radius,0,2*Math.PI),t.stroke(),t.globalCompositeOperation="lighter",t.fillStyle=o,t.beginPath(),t.arc(e,i,.9*r.radius,0,2*Math.PI),t.fill(),t.restore()}}spawnMirrorRipple(t=.6){const s=this.map(t+.3*this.spectralFlare,0,3,240,540),e=this.map(t+.3*this.spectralFlare,0,3,4,18),i=.7*Math.hypot(this.width,this.height);this.ripples.push({radius:.05*this.width,speed:s,bandWidth:e,alpha:.35+.22*t,maxRadius:i})}reseedFields(){this.smokeWisps=this.createSmokeWisps(64),this.mirrorShards=this.createMirrorShards(28),this.mirrorPanels=this.createMirrorPanels(8),this.apparitionLayers=this.createApparitionLayers(14),this.beamParticles=this.createBeamParticles(52),this.lensEmbers=this.createLensEmbers(24)}createSmokeWisps(t){const s=[];for(let e=0;e<t;e++){const t=e%3==0?0:Math.random()<.5?-1:1;s.push({seed:Math.random()*Math.PI*2,phase:Math.random()*Math.PI*2,speed:this.map(Math.random(),0,1,.3,1.8),side:t,spread:this.map(Math.random(),0,1,.08,.32),offsetY:Math.random()-.5,layer:Math.random()<.5?0:1,baseThickness:this.map(Math.random(),0,1,26,90),range:this.map(Math.random(),0,1,40,180),depth:this.map(Math.random(),0,1,.2,1)})}return s}createMirrorShards(t){const s=[];for(let e=0;e<t;e++)s.push({seed:Math.random()*Math.PI*2,phase:Math.random()*Math.PI*2,orbit:this.map(Math.random(),0,1,.12,.42),heightFactor:this.map(Math.random(),0,1,.18,.82),baseSize:this.map(Math.random(),0,1,30,90),spin:this.map(Math.random(),0,1,.6,2.2),colorShift:this.map(Math.random(),0,1,-40,60)});return s}createMirrorPanels(t){const s=[];for(let e=0;e<t;e++)s.push({seed:Math.random()*Math.PI*2,phase:Math.random()*Math.PI*2,side:e%2==0?-1:1,orbit:this.map(Math.random(),0,1,.18,.38),heightBase:this.map(Math.random(),0,1,.2,.75),heightScale:this.map(Math.random(),0,1,.24,.44),widthScale:this.map(Math.random(),0,1,.08,.18),swing:this.map(Math.random(),0,1,.06,.18),oscillation:this.map(Math.random(),0,1,.6,1.4),hueShift:this.map(Math.random(),0,1,-25,35)});return s}createApparitionLayers(t){const s=[];for(let e=0;e<t;e++)s.push({seed:Math.random()*Math.PI*2,phase:Math.random()*Math.PI*2,radius:this.map(Math.random(),0,1,.08,.22),depth:this.map(Math.random(),0,1,.4,1),drift:this.map(Math.random(),0,1,.4,1.4),points:6+Math.floor(6*Math.random()),curl:this.map(Math.random(),0,1,1.2,2.8),wave:this.map(Math.random(),0,1,.8,1.6),eccentricity:this.map(Math.random(),0,1,.6,1.2),hueShift:this.map(Math.random(),0,1,-20,40)});return s}createBeamParticles(t){const s=[];for(let e=0;e<t;e++)s.push({seed:Math.random()*Math.PI*2,offset:this.map(Math.random(),0,1,-1,1),y:this.map(Math.random(),0,1,.35*this.height,.92*this.height),speed:this.map(Math.random(),0,1,40,140),size:this.map(Math.random(),0,1,1.4,3.8),layer:this.map(Math.random(),0,1,.2,1)});return s}createLensEmbers(t){const s=[];for(let e=0;e<t;e++)s.push({seed:Math.random()*Math.PI*2,phase:Math.random()*Math.PI*2,radiusMod:this.map(Math.random(),0,1,.5,1.8),speed:this.map(Math.random(),0,1,.4,1.6),rise:this.map(Math.random(),0,1,.1,.4),brightness:this.map(Math.random(),0,1,.1,.35),size:this.map(Math.random(),0,1,1.2,3.2)});return s}extractChannelEnergy(t){if(!t||!t.length)return 0;let s=0;const e=Math.max(1,Math.floor(t.length/64));for(let i=0;i<t.length;i+=e)s+=t[i];const i=s/(t.length/e);return this.clamp(i/255,0,1.5)}safeGradient(t,s,e,i,h){return Number.isFinite(s)||(s=0),Number.isFinite(e)||(e=0),Number.isFinite(i)||(i=s+1),Number.isFinite(h)||(h=e+1),s===i&&e===h&&(i+=1e-4),t.createLinearGradient(s,e,i,h)}safeRadialGradient(t,s,e,i,h,r,o){return Number.isFinite(s)||(s=0),Number.isFinite(e)||(e=0),(!Number.isFinite(i)||i<0)&&(i=0),Number.isFinite(h)||(h=s),Number.isFinite(r)||(r=e),(!Number.isFinite(o)||o<=0)&&(o=i+1),o===i&&(o=i+1),t.createRadialGradient(s,e,i,h,r,o)}lerp(t,s,e){return t+(s-t)*e}clamp(t,s,e){return Math.min(Math.max(t,s),e)}map(t,s,e,i,h){return e===s?i:i+(t-s)/(e-s)*(h-i)}safeNumber(t,s=0){return Number.isFinite(t)?t:s}}"undefined"!=typeof window&&(window.SmokeAndMirrorsVisualizer=SmokeAndMirrorsVisualizer);