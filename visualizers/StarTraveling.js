class StarTravelingVisualizer extends BaseVisualizer{constructor(t,a={}){super(t,{backgroundColor:"rgba(0,0,0,0)",force2d:!0,smoothing:0,sensitivity:1,debug:!1,...a}),this.rotation=0,this.verticalOffset=0,this.starCount=600;const i=Math.sqrt(this.width*this.width+this.height*this.height);this.stars=Array.from({length:this.starCount},()=>({x:(Math.random()-.5)*i*2,y:(Math.random()-.5)*i*2,z:Math.random()*this.width*1.5,baseSize:2*Math.random()+.5})),this.staticStarCount=1e3,this.staticStars=[];const s=this.createOverlay("movingStars",1);this.movingStarsCtx=s.ctx,this._drawStaticStars()}onResize(){this._drawStaticStars()}onUpdate(t){this.audio=t}onRender(){if(!this.ctx||!this.audio||!this.movingStarsCtx)return;const t=this.audio,a=t?.aWeighted?.mono?.normalized??0,i=t.midEnergy??0,s=(t.centroid,this.movingStarsCtx),h=this.width,r=this.height;s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,s.canvas.width,s.canvas.height),this.rotation+=.1*a,this.verticalOffset=this.map(i,0,1,r/6,-r/6);const e=.85+.3*a;this.canvas.style.transform=`rotate(${-this.rotation}rad) scale(${e})`,s.save();const o=window.devicePixelRatio||1;s.translate(h*o/2,r*o/2+this.verticalOffset*o),s.rotate(this.rotation);const n=3+25*a,c=.3+1.7*a,l=Math.sqrt(h*h+r*r);for(let t of this.stars){if(t.z-=n,t.z<=0){t.z=1.5*h;const a=Math.random()*Math.PI*2,i=Math.random()*l*1.2;t.x=Math.cos(a)*i,t.y=Math.sin(a)*i}const a=128/t.z,i=t.x*a*c,r=t.y*a*c,e=Math.max(.1,t.baseSize*(2-t.z/(1.5*h)*1.5)*.4),o=80*(1-t.z/(1.5*h))+40,d=Math.max(.3,1*(1-t.z/(1.5*h)));s.fillStyle=`hsla(0, 0%, ${o}%, ${.4*d})`,s.beginPath(),s.arc(i,r,Math.max(.1,2.5*e),0,2*Math.PI),s.fill(),s.fillStyle=`hsla(0, 0%, ${o}%, ${d})`,s.beginPath(),s.arc(i,r,e,0,2*Math.PI),s.fill()}}_drawStaticStars(){this.staticStars=Array.from({length:this.staticStarCount},()=>({x:Math.random()*this.width,y:Math.random()*this.height,baseAlpha:.6*Math.random()+.3,size:2*Math.random()+.3,twinkleSeed:Math.random()*Math.PI*2}));for(let t of this.staticStars){const a=.5*Math.sin(.001*performance.now()+t.twinkleSeed)+.5,i=t.baseAlpha*a;this.ctx.fillStyle=`rgba(255,255,255,${i})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}}}window.StarTravelingVisualizer=StarTravelingVisualizer;