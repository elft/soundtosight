class StarTravelingVisualizer extends BaseVisualizer{async init(){this.rotation=0,this.verticalOffset=0,this.starCount=800;const t=Math.sqrt(this.width**2+this.height**2);this.stars=Array.from({length:this.starCount},()=>({x:(Math.random()-.5)*t*2,y:(Math.random()-.5)*t*2,z:Math.random()*this.width*1.6,baseSize:1.5*Math.random()+.4,hue:360*Math.random(),trail:[]})),this.trails=[],this.ripples=[],this.lastRippleTime=0,this.baseHue=210,this.hueShift=0;const i=this.createOverlay("movingStars",1);this.movingCtx=i.ctx}onUpdate(t){this.audio=t}onRender(){if(!this.audio||!this.movingCtx)return;const t=this.movingCtx,i=this.width,a=this.height,{aWeighted:e,centroid:s,bassEnergy:h,trebleEnergy:r,midEnergy:l,isMassiveEnergyChange:n,energyChangeIntensity:o}=this.audio,d=e?.mono?.normalized??0,p=this.map(s,0,8e3,180,360),g=5+60*h,c=.5+1.2*d,m=.18+.15*l;t.setTransform(1,0,0,1,0,0),t.fillStyle=`rgba(0,0,0,${m})`,t.fillRect(0,0,i,a),t.save(),t.translate(i/2,a/2),t.rotate(this.rotation),this.rotation+=.003*r,n&&performance.now()-this.lastRippleTime>1e3&&(this.lastRippleTime=performance.now(),this.ripples.push({r:0,strength:2*o+.3,hue:p,alpha:1}));for(let i=this.ripples.length-1;i>=0;i--){const a=this.ripples[i];a.r+=4*g,a.alpha*=.96,a.alpha<.03&&this.ripples.splice(i,1);const e=t.createRadialGradient(0,0,.5*a.r,0,0,a.r);e.addColorStop(0,`hsla(${a.hue}, 100%, 80%, ${.5*a.alpha})`),e.addColorStop(1,`hsla(${a.hue}, 100%, 50%, 0)`),t.fillStyle=e,t.beginPath(),t.arc(0,0,a.r,0,2*Math.PI),t.fill()}for(const i of this.stars){i.z-=g,i.z<=.3&&(i.z=1.4*this.width,i.x=(Math.random()-.5)*this.width*2,i.y=(Math.random()-.5)*this.height*2,i.trail.length=0);const a=128/i.z,e=i.x*a*c,s=i.y*a*c,h=Math.max(.2,i.baseSize*(2-i.z/(1.4*this.width))*.4),r=Math.min(100,100*(1-i.z/(1.4*this.width))+20);i.hue=(this.baseHue+p+.02*i.hue)%360,i.trail.unshift({x:e,y:s,size:h}),i.trail.length>6&&i.trail.pop(),t.strokeStyle=`hsla(${i.hue}, 100%, ${r}%, ${.2+.6*d})`,t.lineWidth=1.6*h,t.beginPath();for(let a=0;a<i.trail.length-1;a++){const e=i.trail[a],s=i.trail[a+1];t.moveTo(e.x,e.y),t.lineTo(s.x,s.y)}t.stroke(),t.fillStyle=`hsla(${i.hue}, 100%, ${r}%, 0.9)`,t.beginPath(),t.arc(e,s,1.2*h,0,2*Math.PI),t.fill()}t.restore();const u=.1+.4*r,f=this.ctx.createRadialGradient(i/2,a/2,0,i/2,a/2,.6*Math.max(i,a));f.addColorStop(0,`hsla(${p+60}, 100%, 70%, ${u})`),f.addColorStop(1,`hsla(${p}, 100%, 40%, 0)`),this.ctx.fillStyle=f,this.ctx.fillRect(0,0,i,a)}}window.StarTravelingVisualizer=StarTravelingVisualizer;