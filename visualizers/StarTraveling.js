class StarTravelingVisualizer extends BaseVisualizer{async init(){this.rotation=0,this.verticalOffset=0;const t=!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(pointer: coarse)").matches,i="undefined"!=typeof window&&window.innerWidth<860;this.isMobileLike=!(!t&&!i),this.starCount=this.isMobileLike?560:800,this.starDepth=1.6*this.width,this.starDiag=Math.sqrt(this.width**2+this.height**2),this.stars=Array.from({length:this.starCount},()=>this._createStar()),this.comets=[],this.trails=this.comets,this.lastCometTime=0,this.baseHue=210,this.hueShift=0;const e=this.createOverlay("movingStars",1);this.movingCtx=e.ctx}onUpdate(t){this.audio=t}onResize(){this.starDepth=1.6*this.width,this.starDiag=Math.sqrt(this.width**2+this.height**2);for(const t of this.stars)this._resetStar(t)}onRender(){if(!this.audio||!this.movingCtx)return;const t=this.movingCtx,i=this.width,e=this.height,a=performance.now(),{aWeighted:s,centroid:h=0,bassEnergy:r=0,trebleEnergy:o=0,midEnergy:n=0,isMassiveEnergyChange:l=!1,energyChangeIntensity:c=0,rms:d=0,presenceEnergy:m=0,brillianceEnergy:y=0}=this.audio,f=s?.mono?.normalized??0,x=this.map(h,0,8e3,180,360),u=5+60*r,g=.5+1.2*f,M=.18+.15*n,p=.6*n;t.setTransform(1,0,0,1,0,0),t.fillStyle=`rgba(0,0,0,${M})`,t.fillRect(0,0,i,e),t.save(),t.translate(i/2,e/2),t.rotate(this.rotation),this.rotation+=.003*o;const S=l?1+1.8*c:1;l&&a-this.lastCometTime>900&&Math.random()<.5&&(this.lastCometTime=a,this._spawnComet(x,i,e));for(const i of this.stars){i.z-=u*i.depthFactor*S,(i.z<=.3||i.z>this.starDepth)&&this._resetStar(i);const e=i.z/this.starDepth,s=128/Math.max(i.z,.3),h=i.x*s*g,l=i.y*s*g,{x:c,y:y}=this._applySwirl(h,l,p);0===i.layer?i.hue=(210+x+200*r)%360:1===i.layer?i.hue=(280+x+120*n)%360:i.hue=(x+160*o)%360;const M=Math.max(.18,i.baseSize*(1.4-e)*.6),w=1+Math.sin(.002*a+.02*i.hue)*d*.25,b=Math.max(.12,M*w),v=Math.min(100,100*(1-e)+15+12*m);i.trail.unshift({x:c,y:y,size:b}),i.trail.length>6&&i.trail.pop(),t.strokeStyle=`hsla(${i.hue}, 100%, ${v}%, ${.18+.55*f})`,t.lineWidth=b*(1.4+.4*i.depthFactor),t.beginPath();for(let e=0;e<i.trail.length-1;e++){const a=i.trail[e],s=i.trail[e+1];t.moveTo(a.x,a.y),t.lineTo(s.x,s.y)}t.stroke(),t.fillStyle=`hsla(${i.hue}, 100%, ${v}%, 0.9)`,t.beginPath(),t.arc(c,y,1.15*b,0,2*Math.PI),t.fill()}for(let i=this.comets.length-1;i>=0;i--){const e=this.comets[i];e.x+=e.vx,e.y+=e.vy,e.vx*=.97,e.vy*=.97,e.life-=1;const a=this._applySwirl(e.x,e.y,.8*p);e.history.unshift({x:a.x,y:a.y}),e.history.length>20&&e.history.pop();const s=Math.max(0,e.life/e.maxLife);if(e.history.length>1){t.strokeStyle=`hsla(${(e.hue+20)%360}, 100%, 80%, ${.4*s})`,t.lineWidth=2+3*s,t.beginPath();const[i,...a]=e.history;t.moveTo(i.x,i.y);for(const i of a)t.lineTo(i.x,i.y);t.stroke()}t.fillStyle=`hsla(${e.hue}, 100%, 90%, ${.9*s})`,t.beginPath(),t.arc(a.x,a.y,2+3*s,0,2*Math.PI),t.fill(),e.life<=0&&this.comets.splice(i,1)}if(l){const a=Math.min(1,4*c);if(a>.01){const s=Math.max(i,e);t.save(),t.globalCompositeOperation="screen";const h=t.createRadialGradient(0,0,.12*s,0,0,s);h.addColorStop(0,`rgba(255,255,255,${.12*a})`),h.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=h,t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.fill(),t.restore()}}if(t.restore(),this.ctx){this.hueShift=(this.hueShift+.5*o+.2*y)%720;const t=.08+.35*o,s=50*Math.sin(5e-5*a+m),h=50*Math.cos(5e-5*a+.5*m),r=.6*Math.max(i,e),n=this.ctx.createRadialGradient(i/2+s,e/2+h,0,i/2,e/2,r);n.addColorStop(0,`hsla(${(x+60+this.hueShift)%360}, 100%, 70%, ${t})`),n.addColorStop(1,`hsla(${(x+.5*this.hueShift)%360}, 100%, 30%, 0)`),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle=n,this.ctx.fillRect(0,0,i,e)}}_createStar(){const t=Math.random();let i=2;t<.4?i=0:t<.7&&(i=1);const e=0===i?.4:1===i?.7:1.2,a=Math.random()*this.starDepth+12*e;return{x:(Math.random()-.5)*this.starDiag*2,y:(Math.random()-.5)*this.starDiag*2,z:Math.max(.4,a),baseSize:1.5*Math.random()+.4,hue:360*Math.random(),trail:[],layer:i,depthFactor:e}}_resetStar(t){if(!t)return;const i=this._createStar();t.x=i.x,t.y=i.y,t.z=i.z,t.baseSize=i.baseSize,t.hue=i.hue,t.layer=i.layer,t.depthFactor=i.depthFactor,t.trail.length=0}_spawnComet(t,i,e){const a=50+Math.floor(20*Math.random());this.comets.push({x:(Math.random()-.5)*i,y:(Math.random()-.5)*e,vx:40*(Math.random()-.5),vy:40*(Math.random()-.5),life:a,maxLife:a,hue:t,history:[]})}_applySwirl(t,i,e){if(e<=0)return{x:t,y:i};const a=Math.sqrt(t*t+i*i);if(!Number.isFinite(a)||0===a)return{x:t,y:i};const s=Math.atan2(i,t)+e*Math.exp(.002*-a),h=Math.cos(s)*a,r=Math.sin(s)*a;return Number.isFinite(h)&&Number.isFinite(r)?{x:h,y:r}:{x:t,y:i}}}window.StarTravelingVisualizer=StarTravelingVisualizer;