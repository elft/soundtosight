class HypnoVortexIllusionVisualizer extends BaseVisualizer{constructor(t,s={}){super(t,{backgroundColor:"#000000",force2d:!0,smoothing:.25,sensitivity:1,debug:!1,...s}),this.t=0,this.ringCount=32,this.voiceFundamental=0,this.voiceOvertone=0,this.voiceAir=0,this.pulses=[],this.baseRadius=0,this.currentRadius=0,this.stereo=0,this.hue=200,this.lastEnergy=0,this.armPhase=0,this.riftPhase=0,this.backgroundPulse=0,this.swirlArms=Array.from({length:6},(t,s)=>({offset:s/6,jitter:Math.random()*Math.PI*2,angle:0,intensity:0,stretch:1})),this.orbitals=Array.from({length:14},(t,s)=>({angle:Math.random()*Math.PI*2,radius:0,speed:.004+.01*Math.random(),size:2.5+4*Math.random(),phase:Math.random()*Math.PI*2,brightness:.3,hueShift:18*s}))}onUpdate(t){this.t+=.006+.0025*t.midEnergy,this.bass=.0025*t.bassEnergy,this.mid=.0022*t.midEnergy,this.high=9e-4*t.trebleEnergy,this.stereo=1.6*t.stereoBalance,this.lastEnergy+=.2*(t.energy-this.lastEnergy);const s=.45*Math.min(this.width,this.height);this.baseRadius+=.2*(s-this.baseRadius);const e=[["subBassEnergy",260],["bassEnergy",220],["lowMidEnergy",180],["midEnergy",140],["upperMidEnergy",90],["presenceEnergy",55],["trebleEnergy",25],["brillianceEnergy",300]];let i=e[0];for(let s of e)t[s[0]]>t[i[0]]&&(i=s);if(this.hue=i[1],this.voiceFundamental=.0028*t.lowMidEnergy+.0022*t.midEnergy,this.voiceOvertone=.0034*t.upperMidEnergy+.0032*t.presenceEnergy,this.voiceAir=.0012*t.trebleEnergy+.0014*t.brillianceEnergy,t.energyChangeIntensity>.035){const s=Math.min(1,3*t.energyChangeIntensity);this.pulses.push({r:0,alpha:.35+.4*s})}for(let s of this.pulses)s.r+=.05*this.baseRadius+100*t.energy,s.alpha*=.92;this.pulses=this.pulses.filter(t=>t.alpha>.01),this.armPhase+=.004+.004*t.lowMidEnergy+.002*t.midEnergy,this.riftPhase+=.006+.003*t.presenceEnergy+.002*t.trebleEnergy,this.backgroundPulse+=.08*(t.energy-this.backgroundPulse);const h=t.presenceEnergy+.6*t.brillianceEnergy;this.swirlArms.forEach((s,e)=>{const i=.22+.9*(e%2==0?t.lowMidEnergy:t.upperMidEnergy)+.4*h;s.intensity+=.12*(i-s.intensity),s.stretch=.7+.9*t.midEnergy+Math.sin(1.3*this.t+6*s.offset)*(.15+.12*this.stereo),s.angle=this.armPhase+s.offset*Math.PI*2+Math.sin(.8*this.t+s.jitter)*(.25+.3*this.stereo)});const r=[t.bassEnergy,t.lowMidEnergy,t.midEnergy,t.upperMidEnergy,t.presenceEnergy,t.trebleEnergy];this.orbitals.forEach((s,e)=>{const i=r[e%r.length];s.angle+=s.speed*(.75+2.5*i);const h=this.baseRadius*(.25+e/this.orbitals.length*.65)+Math.sin(2*this.t+s.phase)*(18+90*i);s.radius+=.18*(h-s.radius);const a=(2+10*i)*(.5+.4*t.energy);s.size+=.2*(a-s.size);const n=.2+1.2*i+.3*t.trebleEnergy;s.brightness+=.15*(n-s.brightness)})}onRender(){const t=this.ctx,s=.5*this.width,e=.5*this.height;t.fillStyle="rgba(0,0,0,0.18)",t.fillRect(0,0,this.width,this.height);const i=.45*Math.min(this.width,this.height);this.currentRadius+=.25*(i-this.currentRadius);const h=this.t+.4*this.stereo,r=1.2*-this.t+.4*this.stereo,a=120*this.bass+80*this.mid,n=Number.isFinite(this.hue)?(this.hue%360+360)%360:200,o=Math.max(0,Math.min(1,Number.isFinite(this.backgroundPulse)?this.backgroundPulse:0)),l=t.createRadialGradient(s,e,.05*i,s,e,1.6*i);l.addColorStop(0,`hsla(${(n+200)%360}, 65%, ${8+25*o}%, 0.85)`),l.addColorStop(.75,`hsla(${(n+40)%360}, 70%, 6%, 0.6)`),l.addColorStop(1,"rgba(0, 0, 0, 0.6)"),t.save(),t.globalCompositeOperation="lighter",t.globalAlpha=.75,t.fillStyle=l,t.fillRect(0,0,this.width,this.height),t.restore(),t.save(),t.translate(s,e),t.globalCompositeOperation="lighter",this.swirlArms.forEach(s=>{t.beginPath();for(let e=0;e<=90;e++){const i=e/90,h=i*(2*Math.PI*.28+.5*s.stretch),r=s.angle+h+.15*Math.sin(8*i+this.riftPhase),n=i*this.currentRadius*(.92+.08*Math.sin(2.4*this.t+10*i+11*s.offset))+Math.sin(4*r+3*this.t)*a*.12,o=Math.cos(r)*n,l=Math.sin(r)*n;0===e?t.moveTo(o,l):t.lineTo(o,l)}const e=(n+180*s.offset+45*this.stereo)%360,i=Math.min(.85,.18+.45*s.intensity);t.lineWidth=1.2+3.2*s.intensity,t.strokeStyle=`hsla(${e}, 90%, 55%, ${i})`,t.shadowBlur=6+18*s.intensity,t.shadowColor=`hsla(${e}, 90%, 65%, ${Math.min(.85,i+.2)})`,t.stroke()}),t.restore(),t.save(),t.globalCompositeOperation="screen";for(let i of this.pulses){const h=Math.max(0,.22*i.r),r=t.createRadialGradient(s,e,h,s,e,Math.max(h+.001,i.r));r.addColorStop(0,`hsla(${n}, 100%, 68%, ${Math.max(0,Math.min(1,.4*i.alpha))})`),r.addColorStop(.45,`hsla(${(n+24)%360}, 100%, 42%, ${Math.max(0,Math.min(1,.25*i.alpha))})`),r.addColorStop(1,`hsla(${n}, 100%, 20%, 0)`),t.fillStyle=r,t.beginPath(),t.arc(s,e,i.r,0,2*Math.PI),t.fill()}t.restore(),t.save(),t.translate(s,e),t.globalCompositeOperation="lighter",this.orbitals.forEach(s=>{const e=Math.cos(s.angle)*s.radius,i=Math.sin(s.angle)*s.radius,h=(n+s.hueShift+60*this.stereo)%360,r=Math.max(.5,1.6*s.size),a=t.createRadialGradient(e,i,0,e,i,2.2*r);a.addColorStop(0,`hsla(${h}, 95%, 60%, ${Math.max(0,Math.min(.7,s.brightness))})`),a.addColorStop(1,`hsla(${h}, 90%, 25%, 0)`),t.fillStyle=a,t.beginPath(),t.arc(e,i,2.2*r,0,2*Math.PI),t.fill()}),t.restore();for(let n=1;n<=this.ringCount;n++){const o=(1.6180339887*n%this.ringCount+18*this.t)%this.ringCount,l=o/this.ringCount,g=i*l*(1+.35*l)*(1+this.voiceFundamental*Math.sin(2*this.t+.15*n)+this.voiceOvertone*Math.sin(6*this.t+.4*n)+this.voiceAir*Math.sin(14*this.t+1.1*n)),d=Math.max(1,5-.12*n);t.lineWidth=d;const c=n%6==0;c&&(t.lineWidth*=1.9);const u=n%2==0?h:r,y=80;t.beginPath();for(let i=0;i<=y;i++){const h=i/y*Math.PI*2,r=g+Math.sin(4*h+3*u)*a*(n/this.ringCount),o=s+Math.cos(h+u)*r,l=e+Math.sin(h-.65*u)*r;0===i?t.moveTo(o,l):t.lineTo(o,l)}const M=(1-o/this.ringCount)*Math.min(.6,.22+.28*this.lastEnergy+2.5*this.high),m=c?1.6*M:M;t.strokeStyle=`hsla(${this.hue+8*n}, 100%, ${c?75:60}%, ${m})`,t.stroke()}}}"undefined"!=typeof window&&(window.HypnoVortexIllusionVisualizer=HypnoVortexIllusionVisualizer);